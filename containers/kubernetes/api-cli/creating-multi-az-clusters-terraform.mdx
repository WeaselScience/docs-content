---
meta:
  title: Creating multi-AZ Kapsule clusters with Terraform
  description: This pages shows you how to create multi-AZ Kapsule clusters with Terraform
content:
  h1: Creating multi-AZ Kapsule clusters with Terraform
  paragraph: This pages shows you how to create multi-AZ Kapsule clusters with Terraform
tags: kubernetes multi-az clusters pools pods nodes terraform
dates:
  validation: 2023-09-07
  posted: 2023-09-07
categories:
  - kubernetes
---

<Macro id="iam-requirements" />

<Message type="requirement">
  - You have an account and are logged into the [Scaleway console](https://console.scaleway.com)
  - You have [created](/containers/kubernetes/how-to/create-cluster) a Kubernetes Kapsule cluster with a [regional Private Network](/containers/kubernetes/reference-content/secure-cluster-with-private-network)
</Message>

In this tutorial we show you how to multi-AZ kapsule clusters using Terraform.

<Message type="important">
  Some node types are not available with Kubernetes. Not all node types are available in all AZs. Even if a node type is available in a certain AZs, it might be out of stock. Make sure you check the availability in the Scaleway console before creating your pools. <br /><br />

  For more details about how to set up a multi-AZ cluster, refer to the [Ensuring resiliency with Multi-AZ Kubernetes clusters](/containers/kubernetes/reference-content/multi-az-clusters) reference page.
</Message>

The Terraform configuration below is an example, you can configure your `.tf` file as you like. To set up a multi-AZ cluster, you must make sure that you have two or more pools, located in different AZs.

1. Configure your `.tf` file.
    ```
    resource "scaleway_vpc" "kapsule" {
        name = "vpc_kapsule"
        tags = ["kapsule"]
    }
    resource "scaleway_vpc_private_network" "kapsule" {
      name   = "pn_kapsule"
      vpc_id = scaleway_vpc.kapsule.id
      tags   = ["kapsule"]
    }
    resource "scaleway_k8s_cluster" "k8s_cluster" {
      name                        = "demo"
      version                     = "1.23.17"
      cni                         = "cilium"
      private_network_id          = scaleway_vpc_private_network.kapsule.id
      delete_additional_resources = true
      depends_on                  = [scaleway_vpc_private_network.kapsule]
    }
    resource "scaleway_k8s_pool" "k8s_pool_1" {
      name               = "demo-pool1"
      cluster_id         = scaleway_k8s_cluster.k8s_cluster.id
      node_type          = "PLAY2-NANO"
      size               = 1
      min_size           = 1
      max_size           = 20
      autoscaling        = true
      autohealing        = true
      container_runtime  = "containerd"
    }
    resource "scaleway_k8s_pool" "k8s_pool_2" {
      name               = "demo-pool2"
      cluster_id         = scaleway_k8s_cluster.k8s_cluster.id
      node_type          = "PLAY2-NANO"
      size               = 1
      min_size           = 1
      max_size           = 20
      zone               = "fr-par-2"
      autoscaling        = true
      autohealing        = true
      container_runtime  = "containerd"
    }
    ```
2. Plan your deployment.
    ```
    terraform plan
    ```
3. Apply your configuration if the deployment plan reflects your configuration file.
    ```
    terraform apply
    ```

